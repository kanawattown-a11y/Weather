<!-- Mapbox CSS -->
<link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />

<!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø·Ù‚Ø³ -->
<div id="weather" style="font-family: Arial, sans-serif; background: #f9f9f9; border-radius: 10px; padding: 20px; width: 300px; margin: 20px auto; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
  <h3>Ø§Ù„Ø·Ù‚Ø³ ÙÙŠ Ø§Ù„Ø³ÙˆÙŠØ¯Ø§Ø¡ Ø§Ù„Ø¢Ù†</h3>
  <p id="temp">...</p>
  <p id="humidity">...</p>
  <p id="wind">...</p>
  <p id="desc">...</p>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
<div id="style-switcher" style="position: absolute; top: 10px; right: 10px; background: white; border-radius: 5px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); padding: 5px; z-index: 10;">
  <button onclick="changeStyle('streets')">Ø´ÙˆØ§Ø±Ø¹</button>
  <button onclick="changeStyle('satellite')">Ø£Ù‚Ù…Ø§Ø± ØµÙ†Ø§Ø¹ÙŠØ©</button>
  <button onclick="changeStyle('outdoors')">ØªØ¶Ø§Ø±ÙŠØ³</button>
</div>

<!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
<div id='map' style='width: 100%; height: 500px; border-radius: 10px; max-width: 800px; margin: 80px auto 40px; position: relative;'></div>

<!-- Mapbox JS -->
<script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>

<script>
  const mapboxToken = 'pk.eyJ1Ijoia2FuYXdhdHRvd24iLCJhIjoiY21kdTI2dGl0MDdibjJxc2RhM3NueXZxZCJ9.uO1pbEZoyzPPHp7LOFffBA';  
  const tomorrowApiKey = 'qtcXEQ29y3U0wLYRWS5cAekT1Bwv4UT8';  
  const lat = 32.7092;
  const lon = 36.5663;

  const weatherDescriptions = {
    1000: "Ø³Ù…Ø§Ø¡ ØµØ§ÙÙŠØ©",
    1100: "ØºØ§Ø¦Ù… Ø¬Ø²Ø¦ÙŠÙ‹Ø§",
    1101: "ØºØ§Ø¦Ù…",
    1102: "ØºØ§Ø¦Ù… Ø¬Ø¯Ù‹Ø§",
    2000: "Ø¶Ø¨Ø§Ø¨",
    4000: "Ù…Ø·Ø± Ø®ÙÙŠÙ",
    4200: "Ù…Ø·Ø± Ù…ØªÙˆØ³Ø·",
    4201: "Ù…Ø·Ø± ØºØ²ÙŠØ±",
    5000: "Ø«Ù„ÙˆØ¬ Ø®ÙÙŠÙØ©",
    6000: "Ø£Ù…Ø·Ø§Ø± Ø«Ù„Ø¬ÙŠØ©",
    8000: "Ø¹Ø§ØµÙØ©"
  };

  async function getWeatherAndMap() {
    try {
      const response = await fetch(`https://api.tomorrow.io/v4/weather/realtime?location=${lat},${lon}&apikey=${tomorrowApiKey}`);
      const data = await response.json();

      if (!data.data || !data.data.values) throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');

      const values = data.data.values;
      const temp = values.temperature;
      const humidity = values.humidity;
      const wind = values.windSpeed;
      const code = values.weatherCode;

      // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³
      document.getElementById("temp").textContent = `Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${temp}Â°C`;
      document.getElementById("humidity").textContent = `Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: ${humidity}%`;
      document.getElementById("wind").textContent = `Ø§Ù„Ø±ÙŠØ§Ø­: ${wind} ÙƒÙ…/Ø³`;
      document.getElementById("desc").textContent = `Ø§Ù„Ø­Ø§Ù„Ø©: ${weatherDescriptions[code] || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©"}`;

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      mapboxgl.accessToken = mapboxToken;
      window.map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [lon, lat],
        zoom: 10
      });

      // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ØªÙƒØ¨ÙŠØ±/ØªØµØºÙŠØ±)
      map.addControl(new mapboxgl.NavigationControl());

      // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹
      class ResetControl {
        onAdd(map) {
          this.map = map;
          this.btn = document.createElement('button');
          this.btn.textContent = 'ğŸ ';
          this.btn.title = 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹';
          this.btn.style.cssText = `
            background: white; 
            border: none; 
            padding: 8px; 
            margin: 10px;
            cursor: pointer;
            font-size: 18px;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
          `;
          this.btn.onclick = () => {
            map.flyTo({center: [lon, lat], zoom: 10});
          };
          const container = document.createElement('div');
          container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
          container.appendChild(this.btn);
          return container;
        }
        onRemove() {
          this.btn.parentNode.removeChild(this.btn);
          this.map = undefined;
        }
      }
      map.addControl(new ResetControl(), 'top-left');

      // Ø£Ø¶Ù Marker Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³
      const popup = new mapboxgl.Popup({ offset: 25 }).setText(
        `Ø§Ù„Ø·Ù‚Ø³: ${weatherDescriptions[code] || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}\nØ¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${temp}Â°C\nØ§Ù„Ø±Ø·ÙˆØ¨Ø©: ${humidity}%\nØ§Ù„Ø±ÙŠØ§Ø­: ${wind} ÙƒÙ…/Ø³`
      );

      new mapboxgl.Marker()
        .setLngLat([lon, lat])
        .setPopup(popup)
        .addTo(map);

      // Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
      map.on('click', (e) => {
        new mapboxgl.Marker()
          .setLngLat(e.lngLat)
          .setPopup(new mapboxgl.Popup().setText(`Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:\n${e.lngLat.lat.toFixed(4)}, ${e.lngLat.lng.toFixed(4)}`))
          .addTo(map);
      });

      // ØªØºÙŠÙŠØ± Ù†Ù…Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      window.changeStyle = function(style) {
        const styleMap = {
          streets: 'mapbox://styles/mapbox/streets-v11',
          satellite: 'mapbox://styles/mapbox/satellite-v9',
          outdoors: 'mapbox://styles/mapbox/outdoors-v12'
        };
        map.setStyle(styleMap[style]);
      };

    } catch (error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³:', error);
      document.getElementById("weather").innerHTML = "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³.";
    }
  }

  getWeatherAndMap();
</script>
